import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,b as a,a as i,d as t,o as n}from"./app-8Wbd9hvN.js";const l={},p=i("h1",{id:"在-nextcloud-aio-容器進入鎖定模式下手動升級紀錄",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#在-nextcloud-aio-容器進入鎖定模式下手動升級紀錄"},[i("span",null,"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄")])],-1),h=i("p",null,"過年時除舊佈新整理房間時",-1),r=i("p",null,"因為移動了 Server 的位置，在重啟服務遇到需要手動更新的狀況",-1),d=t(`<p>關機後重啟服務後，發現 Nextcloud 強制要求更新，我猜是因為我使用的 docker-compose 指定最新版本導致</p><p>因此 Nextcloud 直接進入維護鎖定模式，所以只能進入容器中使用 CLI 來手動更新了</p><h2 id="安裝背景" tabindex="-1"><a class="header-anchor" href="#安裝背景"><span>安裝背景</span></a></h2><p>proxmox 平台中的一個 CT 中，用 Nextcloud AIO 自動部屬和控制所需的其他容器</p><h2 id="升級版本" tabindex="-1"><a class="header-anchor" href="#升級版本"><span>升級版本</span></a></h2><p>27.XX (忘記紀錄) &gt; 27 版的最高版本 &gt; 28.0.2</p><h2 id="過程紀錄" tabindex="-1"><a class="header-anchor" href="#過程紀錄"><span>過程紀錄</span></a></h2><div class="hint-container warning"><p class="hint-container-title">注意</p><p>以下 php 命令開頭的指令需要在運行 Nextcloud 的 docker 容器中執行</p></div><ol><li><p>在 porxmox 中選擇安裝 Nextcloud 的 CT ，進入命令行模式</p></li><li><p>先升級主程式 <a href="https://github.com/nextcloud/all-in-one/discussions/2692" target="_blank" rel="noopener noreferrer">命令參考 (github.com)</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 進入跑 nextcloud 的 docker 容器中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> www-data</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nextcloud-aio-nextcloud</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Switch to the beta channel</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config:system:set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> updater.release.channel</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --value=beta</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Run the update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> updater/updater.phar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-interaction</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-backup</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> app:enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nextcloud-aio</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Switch back to the stable channel</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config:system:set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> updater.release.channel</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --value=stable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>依照 github 說明，第二步驟的 updater 可以多執行幾次</p><p>該命令一次只會升級一個小版本，等到不會升級後在進行下一步</p><p>但我這次只執行一次就升到版本 27 的最新版本了，第二次執行就會直接結束</p></li><li><p>升級 app 如果要繼續升級到版本 28，這次需要先進行 app 升級</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 以下指令需要在 nextcloud 的 docker 容器內執行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常會在這邊遇到錯誤，特別是如果安裝了一些有的沒有的額外 app</p><p>這時可以查看錯誤 log，鎖定沒辦法更新的 app 名稱，然後使用 occ 命令停用該 app</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 以下指令需要在 nextcloud 的 docker 容器內執行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 列出所有 app 名單</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> app:list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 停用特定 app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> app:disable</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $appname</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>停用之後再次運行，應該就沒問題了</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 以下指令需要在 nextcloud 的 docker 容器內執行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> occ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>升級完成之後可以進行步驟 1 再次進行主程式升級</p></li><li><p>反覆步驟 1~2，可以一步步將版本升級至最新版本</p></li><li><p>完成主程式的更新會自動解除維護模式，就可以正常使用 Nextcloud 了</p></li></ol><h2 id="補充資料" tabindex="-1"><a class="header-anchor" href="#補充資料"><span>補充資料</span></a></h2><ul><li><a href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html" target="_blank" rel="noopener noreferrer">Nextcloud 用 OCC 指令表 (ownCloud Console)</a></li></ul>`,11);function c(o,k){return n(),e("div",null,[p,h,r,a(" more "),d])}const m=s(l,[["render",c],["__file","20240208-1.html.vue"]]),y=JSON.parse('{"path":"/posts/tech/20240208-1.html","title":"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄","lang":"zh-TW","frontmatter":{"title":"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄","shortTitle":"Nextcloud AIO 手動升級","description":"因為移動了 Server 的位置 在重啟服務遇到需要手動更新的狀況","icon":"simple-icons:nextcloud","isOriginal":true,"date":"2024-02-08T21:00:00.000Z","category":["技術"],"tag":["server","nextcloud","docker","proxmox","pin"],"sticky":false,"star":false,"article":true,"timeline":true,"cover":"/assets/posts/nextcloud_hub.png","banner":"/assets/posts/nextcloud_hub.png","head":[["meta",{"property":"og:url","content":"https://bennyz327.github.io/posts/tech/20240208-1"}],["meta",{"property":"og:site_name","content":"BEN周的技術雜記"}],["meta",{"property":"og:title","content":"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄"}],["meta",{"property":"og:description","content":"因為移動了 Server 的位置 在重啟服務遇到需要手動更新的狀況"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bennyz327.github.io/assets/posts/nextcloud_hub.png"}],["meta",{"property":"og:locale","content":"zh-TW"}],["meta",{"property":"og:updated_time","content":"2024-09-01T14:31:13.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://bennyz327.github.io/assets/posts/nextcloud_hub.png"}],["meta",{"name":"twitter:image:alt","content":"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄"}],["meta",{"property":"article:author","content":"Benny Chou"}],["meta",{"property":"article:tag","content":"server"}],["meta",{"property":"article:tag","content":"nextcloud"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"proxmox"}],["meta",{"property":"article:tag","content":"pin"}],["meta",{"property":"article:published_time","content":"2024-02-08T21:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-01T14:31:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"在 Nextcloud AIO 容器進入鎖定模式下手動升級紀錄\\",\\"image\\":[\\"https://bennyz327.github.io/assets/posts/nextcloud_hub.png\\"],\\"datePublished\\":\\"2024-02-08T21:00:00.000Z\\",\\"dateModified\\":\\"2024-09-01T14:31:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Benny Chou\\",\\"url\\":\\"https://github.com/bennyz327\\",\\"email\\":\\"bennyz327@gmail.com\\"}]}"]]},"headers":[{"level":2,"title":"安裝背景","slug":"安裝背景","link":"#安裝背景","children":[]},{"level":2,"title":"升級版本","slug":"升級版本","link":"#升級版本","children":[]},{"level":2,"title":"過程紀錄","slug":"過程紀錄","link":"#過程紀錄","children":[]},{"level":2,"title":"補充資料","slug":"補充資料","link":"#補充資料","children":[]}],"git":{"createdTime":1724868499000,"updatedTime":1725201073000,"contributors":[{"name":"Benny Chou","email":"bennyz327@gmail.com","commits":2},{"name":"benny-office","email":"bennyz327@gmail.com","commits":1}]},"readingTime":{"minutes":2.46,"words":738},"filePathRelative":"posts/tech/20240208-1.md","localizedDate":"2024年2月8日","excerpt":"\\n<p>過年時除舊佈新整理房間時</p>\\n<p>因為移動了 Server 的位置，在重啟服務遇到需要手動更新的狀況</p>\\n"}');export{m as comp,y as data};
